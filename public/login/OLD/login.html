<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UFT-8">
        <title>Sawyer Talks Login</title>
        <meta name="viewport" content="width=device-width; initial-scale=1.0;">
         <!-- Cool Google Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Bowlby+One+SC&display=swap" rel="stylesheet">
        <!-- Our stylesheet -->
        <link rel="stylesheet" href="../login/index.css">
        <script src="index.js"></script>
    </head>
    <body>
        <div id="fb-root"></div>
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v13.0&appId=651060099299719&autoLogAppEvents=1" nonce="G3B1dHdJ"></script>

        <script>
            window.fbAsyncInit = function() {
            FB.init({
                appId      : '651060099299719',
                cookie     : true,
                xfbml      : true,
                version    : 'v13.0'
            });
                
            FB.AppEvents.logPageView();   
                
            };
        
            (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>

            <div id="login_div">
                <div class="background">
                    <div class="shape"></div>
                    <div class="shape"></div>
                </div>
                <div class="container" >
                <form>
                    
                        <h2 class="form_header"> Sawyer Talks | Login </h2>
                    
            
                    <label for="email">Email</label>
                    <input type="email" placeholder="Email" id="email">
            
                    <label for="password">Password</label>
                    <input type="password" placeholder="Password" id="password">
                    
                    
                    </form>
                    <button id="emaillogin">Login</button>
                    <button type="button" onclick="window.location.href='/login/register.html'">New? Register Today!</button>
                    <button class="social-signin github" id='gitlogin'>GitHub Login</button>
                    <button class="social-signin google" id='googlelogin'>Log in with Google+</button>
                    <button class="social-signin twitter" id='twitterlogin'>Twitter Twitter Twitter</button>
                    <div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-layout="rounded" data-auto-logout-link="true" data-use-continue-as="false"></div>

                </div>
            </div>
            
            <div id="user_div">
                <div class="container">
                    <h2>Welcome!</h2>
                    <p id="user_para">Welcome to Life in Focud. You're currently logged in.</p>
                    <button type="button" onclick="window.location.href='../index.html'">Home</button>
                    <button type="button" onclick="logout()">Logout</button>
                    
                </div>
            </div>
        
    </body>

    
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>

    <!-- Our script must be loaded after firebase references -->
    <script src="index.js"></script>
    <script type="module">


        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, GoogleAuthProvider, signInWithRedirect, getRedirectResult, signInWithPopup, signOut, GithubAuthProvider, TwitterAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"; 
        


            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyDem8bmXb7CkyTAXVlj9YgU_KI8q8dOLCM",
                authDomain: "auth.lifeinfocuspod.com",
                databaseURL: "https://life-in-focus-84b0b-default-rtdb.firebaseio.com",
                projectId: "life-in-focus-84b0b",
                storageBucket: "life-in-focus-84b0b.appspot.com",
                messagingSenderId: "529807766553",
                appId: "1:529807766553:web:118db0491646320ef56688"
            };
            // Initialize Firebase
            const app = initializeApp(firebaseConfig); 
            const auth = getAuth(app);
            const database = firebase.database();

            // Auth Checking


            // Email Login
            // Set up our register function
            // Set up our login function
            emaillogin.addEventListener('click',(e) => {
                // Get all our input fields
                var email = document.getElementById('email').value;
                var password = document.getElementById('password').value;

                // Validate input fields
                if (validate_email(email) == false || validate_password(password) == false) {
                alert('Email or Password is Outta Line!!');
                return
                // Don't continue running the code
                };

                auth.signInWithEmailAndPassword(email, password)
                .then(function() {
                // Declare user variable
                var user = auth.currentUser

                // Add this user to Firebase Database
                var database_ref = database.ref()

                // Create User data
                var user_data = {
                    last_login : Date.now()
                }

                // Push to Firebase Database
                database_ref.child('users/' + user.uid).update(user_data)

                // DOne
                alert('User Logged In!!')

                })
                .catch(function(error) {
                // Firebase will use this to alert of its errors
                var error_code = error.code
                var error_message = error.message

                alert(error_message)
                })
            });




            // Validate Functions
            function validate_email(email) {
                var expression = /^[^@]+@\w+(\.\w+)+\w$/
                if (expression.test(email) == true) {
                // Email is good
                return true
                } else {
                // Email is not good
                return false
                }
            };

            function validate_password(password) {
                // Firebase only accepts lengths greater than 6
                if (password < 6) {
                return false
                } else {
                return true
                }
            };

            function validate_field(field) {
                if (field == null) {
                return false
                }

                if (field.length <= 0) {
                return false
                } else {
                return true
                }
            };

            function logout(){
                firebase.auth().signOut();
            };


            // Google Login
            const googleProvider = new GoogleAuthProvider(app);

            googlelogin.addEventListener('click',(e) => {
            signInWithPopup(auth, googleProvider)
            .then((result) => {
                // This gives you a Google Access Token. You can use it to access the Google API.
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                // The signed-in user info.
                const user = result.user;


                alert(user.displayName);
                // ...
                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.email;
                    // The AuthCredential type that was used.
                    const credential = GoogleAuthProvider.credentialFromError(error);
                    // ...

                    alert(errorMessage);
                });
            });


            // Github login
            const githubProvider = new GithubAuthProvider(app);
            gitlogin.addEventListener('click',(e) => {

            signInWithRedirect(auth, githubProvider);
            getRedirectResult(auth, githubProvider)
            .then((result) => {
                const credential = GithubAuthProvider.credentialFromResult(result);
                if (credential) {
                // This gives you a GitHub Access Token. You can use it to access the GitHub API.
                const token = credential.accessToken;
                // ...
                }

                // The signed-in user info.
                const user = result.user;
                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.email;
                    // The AuthCredential type that was used.
                    const credential = GithubAuthProvider.credentialFromError(error);
                    // ...
                });
            });


            // twitter Login
            const twitterProvider = new TwitterAuthProvider(app);
            twitterlogin.addEventListener('click',(e) => {
            signInWithRedirect(auth, twitterProvider);
            getRedirectResult(auth, twitterProvider)
            .then((result) => {
                // This gives you a the Twitter OAuth 1.0 Access Token and Secret.
                // You can use these server side with your app's credentials to access the Twitter API.
                const credential = TwitterAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                const secret = credential.secret;
                // ...

            // The signed-in user info.
                const user = result.user;
                alert(user.displayName);
                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.email;
                    // The AuthCredential type that was used.
                    const credential = TwitterAuthProvider.credentialFromError(error);
                    // ...
                });
            })
            
            

    </script>

    

</html>